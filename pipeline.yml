# REF: http://ci.test.terminus.io/generate
# 声明 pipeline.yml 的版本。
# 字段说明：string 类型，注意使用 引号（单、双引号均可）。
version: "1.1"

# cron: 0 */10 * * * ?

# 全局环境并不是必须的
envs:
  PROJECT_NAME: big_white

# pipeline 的不同阶段声明。
stages:
  - stage:
      - git-checkout:
          params:
            depth: 1

  # 部署 node 服务
  - stage:
      - buildpack:
          alias: herd
          params:
            bp_args:
              DOMAIN_NAME: ((DOMAIN_NAME))
            bp_repo: ((bp.repo.prefix))/dice-bpack-termnodejs.git
            bp_ver: ((bp.repo.default.version))
            context: ${git-checkout}
            modules:
              - name: herd
                path: .
          resources:
            cpu: 1
            mem: 1024
  # 构建镜像
  - stage:
      - release:
          params:
            dice_yml: ${git-checkout}/dice.yml
            replacement_images:
              - ${herd}/pack-result

  # 部署
  - stage:
      - dice:
          alias: deploy
          resources:
            cpu: 1
            mem: 1024
          params:
            time_out: 300
            release_id_path: ${release}
